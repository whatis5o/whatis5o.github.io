<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Admin Dashboard - AfriStay</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Oleo+Script+Swash+Caps:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="assets/css/dashboard.css">
    </head>
    <body>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="mobile-header" id="mobileHeader">
        <button id="mobileMenuBtn" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>
        <h1>AfriStay</h1>
    </div>

    <aside class="sidebar" id="sidebar">
        <div class="logo-area"><h1>AfriStay</h1></div>
        <nav class="nav" id="mainNav">
        <button class="nav-btn active" data-tab="dashboard"><i class="fa-solid fa-chart-line"></i> <span>Dashboard</span></button>
        <button class="nav-btn" data-tab="users"><i class="fa-solid fa-users"></i> <span>Users</span></button>
        <button class="nav-btn" data-tab="listings"><i class="fa-solid fa-list"></i><span>Listings</span></button>
        <button class="nav-btn" data-tab="bookings"><i class="fa-solid fa-calendar-check"></i><span>Bookings</span></button>
        <button class="nav-btn" data-tab="events"><i class="fa-solid fa-calendar-day"></i><span>Events</span></button>
        <button class="nav-btn" data-tab="promotions"><i class="fa-solid fa-tags"></i><span>Promotions</span></button>
        <button class="nav-btn" data-tab="messages"><i class="fa-solid fa-envelope"></i><span>Messages</span></button>
        <button class="nav-btn" data-tab="settings"><i class="fa-solid fa-gear"></i><span>Settings</span></button>
        <button class="nav-btn logout" id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i><span>Logout</span></button>
        </nav>
    </aside>

    <main class="main-content" id="mainContent">
        <!-- Desktop Sidebar Toggle -->
        <div class="desktop-header">
            <button id="toggleSidebarBtn" class="toggle-sidebar-btn">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboardPanel" class="content-panel active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-users"></i></div>
                    <div class="stat-info">
                        <h3>Total Users</h3>
                        <p class="stat-number" id="totalUsers">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-home"></i></div>
                    <div class="stat-info">
                        <h3>Listings</h3>
                        <p class="stat-number" id="totalListings">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-calendar-check"></i></div>
                    <div class="stat-info">
                        <h3>Bookings</h3>
                        <p class="stat-number" id="totalBookings">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-wallet"></i></div>
                    <div class="stat-info">
                        <h3>Revenue</h3>
                        <p class="stat-number" id="totalRevenue">0 RWF</p>
                    </div>
                </div>
            </div>

            <div class="data-section">
                <div class="section-header">
                    <h2>Recent Bookings</h2>
                    <button class="action-btn" id="refreshDashboardBtn"><i class="fa-solid fa-rotate-right"></i> Refresh</button>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr><th>#</th> <th>ID</th> <th>Item</th> <th>Renter</th> <th>Status</th> <th>Price</th></tr>
                        </thead>
                        <tbody id="recentBookingsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- USERS -->
        <div id="usersPanel" class="content-panel">
            <div class="data-section">
                <div class="section-header">
                    <h2>User Management</h2>
                    <button class="action-btn" id="openCreateUserBtn" onclick="openModal('userModal')"><i class="fa-solid fa-user-plus"></i> Add User</button>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <div class="search-box" style="min-width:220px;">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" id="userSearchInput" placeholder="Search user...">
                        </div>
                        <button class="action-btn" id="fetchUsersBtn"><i class="fa-solid fa-rotate-right"></i></button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr><th>#</th><th>Name</th><th>Email</th><th>Phone</th><th>Role</th><th>Owner</th><th>Status</th><th>Action</th></tr>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- LISTINGS -->
        <div id="listingsPanel" class="content-panel">
            <div class="data-section">
                <div class="section-header" style="flex-direction: column; align-items: flex-start; gap: 15px;">
                    <div style="display:flex; width:100%; justify-content:space-between; align-items:center;">
                        <h2>Manage Listings</h2>
                        <button class="action-btn" id="openCreateListingBtn"><i class="fa-solid fa-plus"></i> Add Listing</button>
                    </div>

                    <div class="filter-toolbar">
                        <div class="search-box">
                            <i id="searchIcon" class="fa-solid fa-search"></i>
                            <input type="text" id="listingSearchInput" placeholder="Search listing...">
                        </div>
                        <select id="filterProvince" class="form-control"></select>
                        <select id="filterDistrict" class="form-control" disabled></select>
                        <select id="filterSector" class="form-control" disabled></select>
                        <button class="btn-primary" style="width:auto; height: 35px; padding:0 18px;" id="resetFiltersBtn">Reset</button>
                    </div>
                </div>

                <!-- add below the table or instead of it -->
                <div id="listingsGrid" class="listings-grid" style="display:none; gap:16px;"></div>

            </div>
        </div>

        <!-- BOOKINGS -->
        <div id="bookingsPanel" class="content-panel">
            <div class="data-section">
                <div class="section-header">
                    <h2>All Bookings</h2>
                    <div class="search-box">
                        <i class="fa-solid fa-search"></i>
                        <input type="text" id="bookingSearchInput" placeholder="Search ID..." onkeyup="filterTable('bookingSearchInput','allBookingsBody')">
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr><th>#</th><th>ID</th><th>Listing</th><th>Renter</th><th>Dates</th><th>Total</th><th>Status</th></tr>
                        </thead>
                        <tbody id="allBookingsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- EVENTS -->
        <div id="eventsPanel" class="content-panel">
            <div class="data-section">
                <div class="section-header">
                    <h2>Events</h2>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <div class="search-box">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" id="eventSearchInput"
                                placeholder="Search events..."
                                onkeyup="filterTable('eventSearchInput','eventsTableBody')">
                        </div>
                        <button class="action-btn" onclick="openModal('eventModal')">
                            <i class="fa-solid fa-plus"></i> Add Event
                        </button>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="data-table">
                        <thead><tr><th>#</th><th>Title</th><th>Date</th><th>Location</th><th>Action</th></tr></thead>
                        <tbody id="eventsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PROMOTIONS -->
        <div id="promotionsPanel" class="content-panel">
            <div class="data-section">
                <div class="section-header">
                    <h2>Promotions</h2>
                    <button class="action-btn" onclick="openModal('promotionModal')"><i class="fa-solid fa-plus"></i> Add Promo</button>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead><tr><th>#</th><th>Title</th><th>Image</th><th>Code</th><th>Listing</th><th>Discount</th><th>Dates</th><th>Action</th></tr></thead>
                        <tbody id="promotionsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- MESSAGES -->
        <div id="messagesPanel" class="content-panel">
            <div class="chat-container">
                <div class="chat-sidebar">
                    <div class="chat-header">
                        <h3>Messages</h3>
                        <div class="search-box" style="margin-top:10px;">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" id="messageUserSearch"
                                placeholder="Search users..."
                                onkeyup="filterChatUsers()">
                        </div>
                    </div>
                    
                    <div class="chat-user-list" id="chatUserList">
                        <div class="chat-user-item active">
                            <div class="chat-user-avatar">U</div>
                            <div class="chat-user-info">
                                <h4>User Name</h4>
                                <p>Last message preview...</p>
                            </div>
                        </div>

                        <div class="chat-user-item">
                            <div class="chat-user-avatar">S</div>
                            <div class="chat-user-info">
                                <h4>Shema</h4>
                                <p>I just sent the backend updates</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat-window">
                    <div class="chat-window-header">
                        <button id="backToChats" style="display:none;">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        <span id="chatWindowHeader">Select a conversation</span>
                    </div>

                    <div class="chat-messages" id="chatMessagesArea"></div>
                    
                </div>
            </div>
        </div>

        <!-- SETTINGS -->
        <div id="settingsPanel" class="content-panel">
            <div class="settings-card">

                <div class="settings-header">
                    <div class="settings-avatar" id="adminAvatar">A</div>
                    <div>
                        <h3 id="adminName">Admin Name</h3>
                        <p id="adminEmailDisplay">admin@email.com</p>
                    </div>
                </div>

                <form id="settingsForm">
                    <div class="form-group">
                        <label>Change Email</label>
                        <input type="email" id="newEmail" class="form-control">
                    </div>

                    <div class="form-group">
                        <label>Change Password</label>
                        <input type="password" id="newPassword" class="form-control">
                    </div>

                    <button type="submit" class="btn-primary">Save Changes</button>
                </form>

            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-main-btn" id="quickMainBtn">
                <i class="fa-solid fa-plus"></i>
            </button>

            <div class="quick-menu" id="quickMenu">
                <button onclick="openModal('listingModal')">
                    <i class="fa-solid fa-home"></i> Add Listing
                </button>
                <button onclick="openModal('promotionModal')">
                    <i class="fa-solid fa-tags"></i> Add Promotion
                </button>
                <button onclick="openModal('eventModal')">
                    <i class="fa-solid fa-calendar-day"></i> Add Event
                </button>
                <button onclick="openModal('userModal')">
                    <i class="fa-solid fa-calendar-day"></i> Add User
                </button>
            </div>
        </div>
                <!-- USER MODAL -->
        <div class="form-modal" id="userModal">
            <div class="form-content">
                <div class="form-header">
                    <h3>Add User</h3>
                    <button class="close-modal" onclick="closeModal('userModal')">&times;</button>
                </div>
                <form class="form-body">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Role</label>
                        <select class="form-control">
                            <option>User</option>
                            <option>Owner</option>
                            <option>Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">Create User</button>
                </form>
            </div>
        </div>


    </main>

    <!-- EVENT MODAL -->
    <div class="form-modal" id="eventModal">
        <div class="form-content">
            <div class="form-header">
                <h3>Add Event</h3>
                <button class="close-modal" onclick="closeModal('eventModal')">&times;</button>
            </div>
            <form id="eventForm" class="form-body">
                <div class="form-group"><label>Event Title</label><input type="text" id="evtTitle" class="form-control" required></div>
                <div class="form-group"><label>Date</label><input type="date" id="evtDate" class="form-control" required></div>
                <div class="form-group"><label>Specific Location</label><input type="text" id="evtLoc" class="form-control" required></div>
                <button type="submit" class="btn-primary">Save Event</button>
            </form>
        </div>
    </div>

    <!-- LISTING MODAL -->
    <div class="form-modal" id="listingModal">
        <div class="form-content" style="width: 820px; max-height: 90vh; overflow-y: auto;">
            <div class="form-header">
                <h3>Add New Listing</h3>
                <button class="close-modal" onclick="closeModal('listingModal')">&times;</button>
            </div>
            <form id="listingForm" class="form-body">
                <div class="form-group" style="position: relative;">
                    <label>Assign to Owner</label>
                    <div class="search-wrapper" style="position:relative;">
                        <input type="text" id="ownerSearch" class="form-control" placeholder="Search Owner Name..." autocomplete="off">
                        <input type="hidden" id="selectedOwnerId">
                        <i class="fa-solid fa-search input-icon" style="position:absolute; right:15px; top:40px; color:#888;"></i>
                        <div id="ownerResults" class="search-results-dropdown" style="display:none;"></div>
                    </div>
                    <small id="selectedOwnerName" style="color: var(--primary); font-weight: bold; display:block; margin-top:6px;"></small>
                </div>

                <div class="form-row" style="display:flex; gap:20px;">
                    <div class="form-group" style="flex:1">
                        <label>Category</label>
                        <select id="listCategory" class="form-control" onchange="updateFormLabels()">
                            <option value="vehicle">Vehicle</option>
                            <option value="real_estate">Real Estate</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex:1">
                        <label id="priceLabel">Price per Day (RWF)</label>
                        <input type="number" id="listPrice" class="form-control" required>
                    </div>
                </div>

                <div class="form-group"><label>Listing Title</label><input type="text" id="listTitle" class="form-control" placeholder="e.g. Toyota RAV4 2023" required></div>

                <div class="form-group location-box" style="background:#f8f9fa; padding:20px; border-radius:12px; border:1px solid #eee;">
                    <label style="color:var(--primary); margin-bottom:12px;">üìç Location Details</label>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:10px;">
                        <select id="selProvince" class="form-control" onchange="loadDistricts()"><option value="">Province</option></select>
                        <select id="selDistrict" class="form-control" onchange="loadSectors()" disabled><option value="">District</option></select>
                        <select id="selSector" class="form-control" disabled><option value="">Sector</option></select>
                    </div>
                    <input type="text" id="listAddress" class="form-control" placeholder="Specific Address (e.g. Near Market)" required>
                </div>

                <div class="form-group"><label>Description</label><textarea id="listDesc" class="form-control" rows="4" style="resize:none;" required></textarea></div>

                <div class="form-group">
                    <label>Images (max 10)</label>
                    <input type="file" id="listImageFiles" class="form-control" accept="image/*" multiple>
                    <small style="color:#666;">Uploads to 'listing-images' bucket. Max 10 images.</small>
                </div>

                <div class="form-group">
                    <label>Videos (max 3)</label>
                    <input type="file" id="listVideoFiles" class="form-control" accept="video/*" multiple>
                    <small style="color:#666;">Uploads to 'listing-videos' bucket. Max 3 videos.</small>
                </div>

                <button type="submit" class="btn-primary" id="createBtn">Create Listing</button>
            </form>
        </div>
    </div>

    <!-- PROMO MODAL -->
    <div class="form-modal" id="promotionModal">
        <div class="form-content">
            <div class="form-header">
                <h3>Add Promotion</h3>
                <button class="close-modal" onclick="closeModal('promotionModal')">&times;</button>
            </div>
            <form id="promoForm" class="form-body">
                <div class="form-group"><label>Promo Code</label><input type="text" id="promoCode" class="form-control" placeholder="SUMMER2026" required></div>
                <div class="form-group"><label>Apply to Listing (Optional)</label><select id="promoListingId" class="form-control"><option value="">-- General Promo --</option></select></div>
                <div class="form-row" style="display:flex; gap:15px;">
                    <div class="form-group" style="flex:1"><label>Discount (%)</label><input type="number" id="promoDiscount" class="form-control" min="1" max="100" required></div>
                    <div class="form-group" style="flex:1"><label>Start Date</label><input type="date" id="promoStart" class="form-control" required></div>
                    <div class="form-group" style="flex:1"><label>End Date</label><input type="date" id="promoEnd" class="form-control" required></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="promoDesc" class="form-control" rows="2"></textarea></div>
                <div class="form-group"><label>Promotion Banner Image</label><input type="file" id="promoImage" class="form-control" accept="image/*"><small>Uploads to 'promotion-images' bucket</small></div>
                <button type="submit" class="btn-primary" id="createPromoBtn">Create Promotion</button>
            </form>
        </div>
    </div>

    <!-- 1. Supabase Library FIRST -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- 2. Config -->
    <script src="assets/js/config.js"></script>

    <!-- 3. Utils -->
    <script src="assets/js/utils.js"></script>

    <!-- 4. Admin -->
    <script src="assets/js/dashboard.js"></script>

</body>
</html>
